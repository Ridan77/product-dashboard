<div class="edit-create-container">
  <div class="header">

    <h1>{{ isEditMode ? 'Edit Product' : 'New Product' }}</h1>

    <mat-error *ngIf="error">{{ error }}</mat-error>

    <!-- Product image (edit mode only) -->
    <img *ngIf="isEditMode && !loading" class="product-image" [src]="getImageUrl(form.get('name')?.value)"
      [alt]="form.get('name')?.value" />
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="product-form">

    <!-- Name -->
    <mat-form-field appearance="outline">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" />
      <mat-error *ngIf="form.get('name')?.hasError('required')">
        Name is required
      </mat-error>
      <mat-error *ngIf="form.get('name')?.hasError('minlength')">
        Minimum 3 characters
      </mat-error>
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea matInput rows="3" formControlName="description"></textarea>
      <mat-error *ngIf="form.get('description')?.invalid">
        Description is required
      </mat-error>
    </mat-form-field>

    <!-- Price -->
    <mat-form-field appearance="outline">
      <mat-label>Price</mat-label>
      <input matInput type="number" formControlName="price" />
      <mat-error *ngIf="form.get('price')?.invalid">
        Price is required
      </mat-error>
    </mat-form-field>

    <!-- Currency -->
    <mat-form-field appearance="outline">
      <mat-label>Currency</mat-label>
      <mat-select formControlName="currency">
        <mat-option value="USD">USD</mat-option>
        <mat-option value="EUR">EUR</mat-option>
        <mat-option value="ILS">ILS</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Category -->
    <mat-form-field appearance="outline">
      <mat-label>Category</mat-label>
      <input matInput formControlName="category" />
    </mat-form-field>

    <!-- Stock -->
    <mat-form-field appearance="outline">
      <mat-label>Stock</mat-label>
      <input matInput type="number" formControlName="stock" />
      <mat-error *ngIf="form.get('stock')?.invalid">
        Stock is required
      </mat-error>
    </mat-form-field>

    <!-- Active -->
    <mat-checkbox formControlName="isActive">
      Active
    </mat-checkbox>

    <!-- Submit -->
    <button mat-raised-button type="submit" [disabled]="loading || form.invalid || (isEditMode && !existingProduct)">
      {{ loading ? 'Saving...' : 'Save' }}
    </button>

  </form>

</div>